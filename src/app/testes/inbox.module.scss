// ─── Layout com abas ──────────────────────────────────────────────────────

.pageWithTabs {
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
  background: var(--bg-canvas);
}

.pageHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  border-bottom: 1px solid var(--border);
  background: var(--bg-surface);
  height: 52px;
  flex-shrink: 0;
}

.pageTitle {
  font-size: var(--text-md);
  font-weight: 700;
  color: var(--text-primary);
  margin-right: 16px;
  padding-right: 16px;
  border-right: 1px solid var(--border);
}

.tabs {
  display: flex;
  align-items: center;
  height: 100%;
  flex: 1;
}

.tabBtn {
  padding: 0 18px;
  height: 100%;
  border: none;
  background: none;
  font-size: var(--text-sm);
  color: var(--text-muted);
  cursor: pointer;
  font-family: var(--font-sans);
  border-bottom: 2px solid transparent;
  transition: color var(--transition-fast), border-color var(--transition-fast);
  &:hover { color: var(--text-primary); }
}

.tabActive {
  color: var(--primary);
  border-bottom-color: var(--primary);
  font-weight: 600;
}

.tabContent {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.headerRight {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}

// ─── Shared ───────────────────────────────────────────────────────────────

.newBtn {
  padding: 6px 14px;
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  font-size: var(--text-xs);
  font-weight: 600;
  cursor: pointer;
  font-family: var(--font-sans);
  white-space: nowrap;
  transition: background var(--transition-fast);
  &:hover { background: var(--primary-hover); }
}

.pollingBadge {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: var(--text-xs);
  color: var(--text-muted);
}
.pollingDot {
  width: 6px; height: 6px; border-radius: 50%; background: #22C55E;
  animation: pulse 2s ease-in-out infinite;
}
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }

// ─── Status badges ─────────────────────────────────────────────────────────

.statusBadge {
  font-size: 10px; font-weight: 600; border-radius: 999px;
  padding: 2px 7px; white-space: nowrap; flex-shrink: 0;
}
.statusRunning { background:#EFF6FF; color:#2563EB; }
.statusWait    { background:#FFFBEB; color:#D97706; }
.statusChat    { background:#F0FDF4; color:#059669; }
.statusDone    { background:#DCFCE7; color:#16A34A; }
.statusError   { background:#FEF2F2; color:#DC2626; }

// ─── Inbox layout ─────────────────────────────────────────────────────────

.inboxLayout {
  display: flex;
  flex: 1;
  overflow: hidden;
}

// ─── Sidebar ──────────────────────────────────────────────────────────────

.sidebar {
  width: 280px;
  flex-shrink: 0;
  background: var(--bg-surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.list { flex: 1; overflow-y: auto; }

.listItem {
  width: 100%; padding: 12px 14px;
  border: none; border-bottom: 1px solid var(--border);
  background: none; text-align: left; cursor: pointer;
  display: flex; flex-direction: column; gap: 4px;
  font-family: var(--font-sans);
  transition: background var(--transition-fast);
  &:hover { background: var(--bg-hover); }
  &.active { background: var(--primary-light); border-left: 3px solid var(--primary); padding-left: 11px; }
}
.itemHeader  { display: flex; align-items: center; justify-content: space-between; gap: 6px; }
.itemFlow    { font-size: var(--text-sm); font-weight: 600; color: var(--text-primary); }
.itemContact { font-size: var(--text-xs); color: var(--text-muted); }
.itemDate    { font-size: var(--text-xs); color: var(--text-muted); }

// ─── Viewer ───────────────────────────────────────────────────────────────

.viewer {
  flex: 1; display: flex; flex-direction: column;
  overflow: hidden; min-width: 0;
}

.emptyViewer {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 12px; color: var(--text-muted); font-size: var(--text-sm);
}
.emptyIcon { font-size: 36px; opacity: .35; }

// ─── Run header ───────────────────────────────────────────────────────────

.runHeader {
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: flex-start;
  justify-content: space-between; gap: 16px;
  background: var(--bg-surface); flex-shrink: 0;
}
.runMeta    { min-width: 0; }
.runTitle   { font-size: var(--text-lg); font-weight: 700; color: var(--text-primary); }
.runContact { font-size: var(--text-sm); color: var(--text-muted); margin-top: 2px; }
.runActions { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.logBtn {
  padding: 4px 10px; border: 1px solid var(--border); background: none;
  color: var(--text-muted); border-radius: var(--radius-sm);
  font-size: var(--text-xs); cursor: pointer; font-family: var(--font-sans);
  transition: background var(--transition-fast);
  &:hover { background: var(--bg-hover); }
}

// ─── Chat banner ──────────────────────────────────────────────────────────

.chatBanner {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 14px 20px;
  background: #ECFDF5; border-bottom: 1px solid #6EE7B7;
  flex-shrink: 0;
}

.chatLink {
  display: inline-flex; align-items: center;
  padding: 7px 14px;
  background: #059669; color: #fff; text-decoration: none;
  border-radius: var(--radius-md);
  font-size: var(--text-xs); font-weight: 600; white-space: nowrap;
  transition: background var(--transition-fast);
  &:hover { background: #047857; }
}

// ─── Wait banner ──────────────────────────────────────────────────────────

.waitBanner {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 14px 20px;
  background: #FFFBEB; border-bottom: 1px solid #FDE68A;
  flex-shrink: 0;
}
.waitIcon { font-size: 22px; flex-shrink: 0; margin-top: 2px; }
.waitInfo { flex: 1; min-width: 0; font-size: var(--text-sm); color: #92400E;
  p { margin-top: 2px; font-size: var(--text-xs); } }
.waitBtns { display: flex; gap: 8px; flex-shrink: 0; flex-wrap: wrap; align-items: center; }

.replyBtn {
  padding: 7px 14px; background: var(--primary); color: #fff;
  border: none; border-radius: var(--radius-md);
  font-size: var(--text-xs); font-weight: 600; cursor: pointer;
  font-family: var(--font-sans); white-space: nowrap;
  transition: background var(--transition-fast);
  &:hover { background: var(--primary-hover); }
}
.timeoutBtn {
  padding: 7px 14px; background: none; color: #92400E;
  border: 1px solid #F59E0B; border-radius: var(--radius-md);
  font-size: var(--text-xs); font-weight: 600; cursor: pointer;
  font-family: var(--font-sans); white-space: nowrap;
  transition: background var(--transition-fast);
  &:hover { background: #FEF3C7; }
}

// ─── Reply box ────────────────────────────────────────────────────────────

.replyBox {
  padding: 12px 20px; border-bottom: 1px solid var(--border);
  background: #F8FAFF; flex-shrink: 0;
  display: flex; flex-direction: column; gap: 8px;
}
.replyHeader {
  display: flex; align-items: center; justify-content: space-between;
  font-size: var(--text-sm); color: var(--text-secondary);
}
.closeReply {
  width: 24px; height: 24px; border: none; background: none;
  font-size: 18px; color: var(--text-muted); cursor: pointer;
  border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;
  &:hover { background: var(--bg-hover); }
}

// ─── Template chips ───────────────────────────────────────────────────────

.templateChips {
  display: flex; flex-wrap: wrap; gap: 6px;
}
.chip {
  padding: 4px 10px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: 999px;
  font-size: var(--text-xs);
  color: var(--text-secondary);
  cursor: pointer;
  font-family: var(--font-sans);
  transition: border-color var(--transition-fast), background var(--transition-fast);
  &:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-light); }
}

.replySubject {
  width: 100%; padding: 7px 10px;
  border: 1px solid var(--border); border-radius: var(--radius-md);
  font-size: var(--text-sm); font-family: var(--font-sans);
  background: var(--bg-surface); color: var(--text-primary); outline: none;
  box-sizing: border-box;
  &:focus { border-color: var(--primary); }
  &::placeholder { color: var(--text-muted); }
}
.replyTextarea {
  width: 100%; padding: 8px 10px; resize: vertical; min-height: 80px;
  border: 1px solid var(--border); border-radius: var(--radius-md);
  font-size: var(--text-sm); font-family: var(--font-sans); line-height: 1.5;
  background: var(--bg-surface); color: var(--text-primary); outline: none;
  box-sizing: border-box;
  &:focus { border-color: var(--primary); }
  &::placeholder { color: var(--text-muted); }
}
.replyFooter   { display: flex; justify-content: flex-end; gap: 8px; }
.cancelReply {
  padding: 6px 14px; border: 1px solid var(--border); background: none;
  color: var(--text-secondary); border-radius: var(--radius-md);
  font-size: var(--text-xs); cursor: pointer; font-family: var(--font-sans);
}
.sendReply {
  padding: 6px 16px; background: var(--primary); color: #fff;
  border: none; border-radius: var(--radius-md);
  font-size: var(--text-xs); font-weight: 600; cursor: pointer;
  font-family: var(--font-sans);
  &:hover { background: var(--primary-hover); }
}

// ─── Log panel ────────────────────────────────────────────────────────────

.logPanel {
  padding: 10px 20px; border-bottom: 1px solid var(--border);
  background: #1E293B; max-height: 200px; overflow-y: auto; flex-shrink: 0;
}
.logTitle {
  font-size: var(--text-xs); font-weight: 700; color: #94A3B8;
  text-transform: uppercase; letter-spacing: .06em; margin-bottom: 8px;
}
.logEntry {
  display: flex; align-items: baseline; gap: 8px;
  padding: 3px 0; font-size: var(--text-xs); font-family: var(--font-mono);
  border-bottom: 1px solid #334155;
  &:last-child { border-bottom: none; }
}
.logIcon   { flex-shrink: 0; color: #94A3B8; }
.logType   { color: #7DD3FC; min-width: 160px; }
.logDetail { color: #CBD5E1; }
.log_ok    { .logIcon { color: #4ADE80; } }
.log_wait  { .logIcon { color: #FCD34D; } }
.log_exit  { .logIcon { color: #A78BFA; } }
.log_error { .logIcon { color: #F87171; } }

// ─── Thread ───────────────────────────────────────────────────────────────

.thread {
  flex: 1; overflow-y: auto; padding: 16px 20px;
  display: flex; flex-direction: column; gap: 12px;
}
.emptyThread {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; gap: 8px; color: var(--text-muted);
  font-size: var(--text-sm); padding: 40px 0; text-align: center;
}

.emailCard {
  border-radius: var(--radius-lg); padding: 14px 16px;
  cursor: pointer; border: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 6px;
  transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
  &:hover { box-shadow: var(--shadow-md); border-color: var(--primary); }
  &.outbound { background: #EFF6FF; border-color: #BFDBFE; align-self: flex-end; max-width: 85%; }
  &.inbound  { background: #F9FAFB; border-color: var(--border); align-self: flex-start; max-width: 85%; }
}
.emailMeta    { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.dirLabel     { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .05em; color: var(--text-muted); }
.emailTime    { font-size: 10px; color: var(--text-muted); }
.emailFrom    { font-size: var(--text-xs); color: var(--text-secondary); }
.emailSubject { font-size: var(--text-sm); font-weight: 600; color: var(--text-primary); }

.inlineReplyBtn {
  align-self: flex-end; margin-top: 4px;
  padding: 4px 10px; background: var(--primary); color: #fff;
  border: none; border-radius: var(--radius-sm);
  font-size: var(--text-xs); font-weight: 600; cursor: pointer;
  font-family: var(--font-sans);
  transition: background var(--transition-fast);
  &:hover { background: var(--primary-hover); }
}

// ─── Email viewer ─────────────────────────────────────────────────────────

.emailViewer {
  flex-shrink: 0; height: 300px;
  border-top: 1px solid var(--border);
  display: flex; flex-direction: column;
  background: var(--bg-surface);
}
.emailViewerHeader {
  padding: 12px 16px; border-bottom: 1px solid var(--border);
  display: flex; align-items: flex-start;
  justify-content: space-between; gap: 16px; flex-shrink: 0;
  font-size: var(--text-sm); font-weight: 600; color: var(--text-primary);
}
.emailViewerMeta { font-size: var(--text-xs); color: var(--text-muted); font-weight: 400; margin-top: 2px; }
.emailViewerBody { flex: 1; overflow: hidden; display: flex; flex-direction: column; }
.emailFrame      { width: 100%; height: 100%; border: none; background: #fff; }
.sourceCode {
  flex: 1; padding: 14px 18px; margin: 0;
  font-family: var(--font-mono); font-size: var(--text-xs);
  color: #E2E8F0; background: #1E293B; overflow: auto;
  white-space: pre-wrap; word-break: break-all; line-height: 1.6;
}
.viewToggle {
  display: flex; background: #F3F4F6; border: 1px solid var(--border);
  border-radius: var(--radius-md); padding: 2px; gap: 2px;
}
.viewToggleBtn {
  padding: 3px 10px; border: none; border-radius: var(--radius-sm);
  font-size: 10px; font-weight: 500; cursor: pointer; font-family: var(--font-sans);
  color: var(--text-muted); background: transparent;
  transition: background var(--transition-fast), color var(--transition-fast);
  &.viewToggleActive { background: var(--bg-surface); color: var(--text-primary); box-shadow: var(--shadow-sm); }
}

// ─── Full tab (Emails + Analytics) ────────────────────────────────────────

.fullTab {
  flex: 1; overflow: hidden;
  display: flex; flex-direction: column;
}

.filterBar {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 20px; border-bottom: 1px solid var(--border);
  background: var(--bg-surface); flex-shrink: 0;
}
.filterSelect {
  padding: 6px 10px;
  border: 1px solid var(--border); border-radius: var(--radius-md);
  font-size: var(--text-sm); color: var(--text-primary);
  font-family: var(--font-sans); background: #F9FAFB; outline: none;
  cursor: pointer;
  transition: border-color var(--transition-fast);
  &:focus { border-color: var(--primary); }
}
.filterCount {
  margin-left: auto;
  font-size: var(--text-xs); color: var(--text-muted);
}

// ─── Email table ──────────────────────────────────────────────────────────

.emailTableWrap {
  flex: 1; overflow-y: auto;
}

.emailTable {
  width: 100%; border-collapse: collapse;
  font-size: var(--text-xs);

  thead tr {
    background: var(--bg-surface);
    position: sticky; top: 0; z-index: 1;
    border-bottom: 2px solid var(--border);
  }
  th {
    padding: 10px 14px; text-align: left;
    font-weight: 700; font-size: 10px;
    text-transform: uppercase; letter-spacing: .05em;
    color: var(--text-muted); white-space: nowrap;
  }
  td { padding: 10px 14px; border-bottom: 1px solid var(--border); }
}

.tableRow {
  cursor: pointer;
  transition: background var(--transition-fast);
  &:hover { background: var(--bg-hover); }
  &.tableRowActive { background: var(--primary-light); }
}
.emptyRow {
  text-align: center; color: var(--text-muted);
  padding: 32px !important; font-style: italic;
}

.dirBadge {
  font-size: 10px; font-weight: 700; border-radius: 999px;
  padding: 2px 8px; white-space: nowrap;
}
.dirOut { background: #EFF6FF; color: #2563EB; }
.dirIn  { background: #F0FDF4; color: #16A34A; }

.tdMono    { font-family: var(--font-mono); font-size: 11px; color: var(--text-secondary); max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.tdSubject { font-weight: 500; color: var(--text-primary); max-width: 220px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.tdMuted   { color: var(--text-muted); max-width: 160px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

// ─── Analytics ────────────────────────────────────────────────────────────

.analyticsBody {
  flex: 1; overflow-y: auto; padding: 20px;
  display: flex; flex-direction: column; gap: 24px;
}

.nodeGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 12px;
}

.nodeCard {
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 16px;
  display: flex; flex-direction: column; gap: 6px;
  transition: box-shadow var(--transition-fast);
  &:hover { box-shadow: var(--shadow-md); }
}
.nodeCardType {
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: .06em; color: var(--text-muted);
}
.nodeCardCount {
  font-size: 28px; font-weight: 800; color: var(--text-primary);
  line-height: 1;
}
.nodeCardLabel {
  font-size: var(--text-xs); color: var(--text-secondary);
  line-height: 1.4;
}
.progressBar {
  height: 4px; border-radius: 99px;
  background: var(--border); overflow: hidden; margin-top: 4px;
}
.progressFill {
  height: 100%; border-radius: 99px;
  background: var(--primary);
  transition: width .4s ease;
}
.nodeCardSub {
  font-size: 10px; color: var(--text-muted);
  font-family: var(--font-mono);
}

.analyticsSection { display: flex; flex-direction: column; gap: 10px; }
.analyticsSectionTitle {
  font-size: var(--text-sm); font-weight: 700; color: var(--text-primary);
}

// ─── Modal ────────────────────────────────────────────────────────────────

.overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,.4);
  display: flex; align-items: center; justify-content: center;
  z-index: 100; backdrop-filter: blur(2px);
}
.modal {
  background: var(--bg-surface); border-radius: var(--radius-lg);
  padding: 28px; width: min(440px, 90vw);
  display: flex; flex-direction: column; gap: 10px;
  box-shadow: var(--shadow-lg);
}
.modalTitle    { font-size: var(--text-lg); font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
.modalLabel    { font-size: var(--text-xs); font-weight: 700; text-transform: uppercase; letter-spacing: .06em; color: var(--text-muted); }
.modalInput, .modalSelect {
  width: 100%; padding: 9px 12px;
  border: 1px solid var(--border); border-radius: var(--radius-md);
  font-size: var(--text-sm); color: var(--text-primary); font-family: var(--font-sans);
  background: #F9FAFB; outline: none; box-sizing: border-box;
  transition: border-color var(--transition-fast);
  &:focus { border-color: var(--primary); background: var(--bg-surface); }
  &::placeholder { color: var(--text-muted); }
}
.modalSelect   { appearance: none; cursor: pointer; }
.modalActions  { display: flex; justify-content: flex-end; gap: 10px; margin-top: 8px; }
.modalCancelBtn {
  padding: 8px 16px; border: 1px solid var(--border); background: none;
  color: var(--text-secondary); border-radius: var(--radius-md);
  font-size: var(--text-sm); cursor: pointer; font-family: var(--font-sans);
}
.modalConfirmBtn {
  padding: 8px 20px; background: var(--primary); color: #fff;
  border: none; border-radius: var(--radius-md);
  font-size: var(--text-sm); font-weight: 600; cursor: pointer;
  font-family: var(--font-sans);
  &:hover:not(:disabled) { background: var(--primary-hover); }
  &:disabled { opacity: .5; cursor: not-allowed; }
}

// ─── Empty states ─────────────────────────────────────────────────────────

.emptyState {
  display: flex; flex-direction: column; align-items: center;
  gap: 8px; padding: 40px 20px; text-align: center;
  color: var(--text-muted); font-size: var(--text-sm); line-height: 1.5;
}
